version = '0.4.99'

subprojects { prj ->
    apply plugin: 'groovy'

    test {
      maxHeapSize = '512m'
      workingDir = '..'
    }

    dependencies {
        groovy(group: 'org.codehaus.groovy', name: 'groovy', version: '1.7.5')
        compile(group: 'org.codehaus.groovy', name: 'groovy', version: '1.7.5')
        compile "junit:junit:4.8.1"
    }

    repositories {
        mavenCentral()
    }

    sourceSets {
        main {
            java {
                srcDir "src"
                classesDir = file("../out/production/${prj.name}")
            }
            groovy {
                srcDir "src"
                classesDir = file("../out/production/${prj.name}")
            }
        }
        test {
            groovy {
                srcDir 'tests'
                classesDir = file("../out/test/${prj.name}")
            }
        }
    }
}

task releaseInfo << {
  copy {
      from './Compiler/src'
      into './out/production/Compiler'
      exclude '**/*.java'
      exclude '**/*.groovy'
  }

  def file = new File("./out/production/Compiler/META-INF/groovypp-release-info.properties")

  def src = file.text
  src = src.replaceAll("##ImplementationVersion##", version)

  def dateTime = new Date()
  src = src.replaceAll("##BuildDate##", dateTime.format("dd-MMM-yyyy"))
  src = src.replaceAll("##BuildTime##", dateTime.format("hh:mm aa"))

  file.text = src
}



